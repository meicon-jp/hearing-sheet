<script>
const sections = {
    "基本情報": [
        ["会社名", "text", true, "例：株式会社ミライデザイン"],
        ["所在地", "text", true, "例：愛知県名古屋市中区〇〇1-2-3"],
        ["設立年月", "text", true, "例：2020年4月"],
        ["資本金", "text", true, "例：300万円"],
        ["事業内容", "textarea", true, "例：Webサイト制作、デザイン、マーケティングなど"],
        ["代表者名", "text", false, "例：山田 太郎"],
        ["担当者名・連絡先", "textarea", true, "例：担当：佐藤 花子 / 080-1234-5678 / sato@example.com"],
        ["公式サイトURL", "text", false, "例：https://example.com"],
        ["SNSアカウント", "textarea", false, "例：Instagram：@example / X：@example_jp"]
    ],
    "目的とターゲット": [
        ["制作の目的", "textarea", true, "例：新規顧客の獲得、採用強化、ブランドイメージ向上など"],
        ["現在の課題・悩み", "textarea", true, "例：既存サイトが古い／スマホ対応ができていない／更新がしづらい など"],
        ["成功の基準（成果指標）", "textarea", false, "例：アクセス数増加／問い合わせ数アップ／採用応募件数 など"],
        ["ターゲット層", "textarea", true, "例：20〜30代の女性／BtoB企業の担当者など"],
        ["訪問者に取ってもらいたい行動（CTA）", "textarea", true, "例：問い合わせフォーム送信／資料請求／LINE登録 など"]
    ],
    "コンテンツ": [
        ["必要なページ一覧", "textarea", true, "例：トップページ／サービス紹介／会社概要／採用情報／お問い合わせ"],
        ["各ページに掲載したい内容", "textarea", true, "例：サービス紹介→特徴・料金・事例を掲載したい など"],
        ["強調したいポイント", "textarea", true, "例：スピード対応／高品質デザイン／低価格パッケージなど"],
        ["使用予定の素材", "textarea", false, "例：ロゴ・写真・動画・イラスト など"],
        ["素材の状態", "text", false, "例：全て準備済み／写真のみ未撮影 など"],
        ["原稿ライティング方法", "text", false, "例：自社で作成／依頼したい"]
    ],
    "デザイン・雰囲気": [
        ["希望のテイスト", "textarea", true, "例：シンプル・モダン・ナチュラル・高級感など"],
        ["使用したいカラー・ブランドカラー", "text", false, "例：黒・白・ゴールド／#333333 など"],
        ["使用NGなカラー・要素", "text", false, "例：派手なピンク／動きが多い演出など"],
        ["参考にしたいサイトURL", "textarea", false, "例：https://example1.jp / https://example2.com"],
        ["使用したいフォント・写真イメージ", "textarea", false, "例：丸みのあるフォント／自然光の写真など"],
        ["レイアウト希望（1カラム・2カラムなど）", "text", false, "例：1カラムでシンプルに"]
    ],
    "機能要件": [
        ["お問い合わせフォーム", "textarea", true, "例：名前・メール・電話・内容・プライバシー同意チェックなど"],
        ["ブログ・ニュース機能", "textarea", false, "例：社内ニュースを更新したい／ブログ形式で発信したいなど"],
        ["SNS連携", "textarea", false, "例：Instagram埋め込み／Xタイムライン表示など"],
        ["多言語対応", "text", false, "例：日本語・英語サイトを切り替えたい"],
        ["SEO対策（希望キーワード等）", "textarea", false, "例：名古屋 Web制作／コーポレートサイト制作 など"],
        ["アクセス解析導入", "text", false, "例：Google Analytics 4 / Search Console"]
    ],
    "スケジュール・予算": [
        ["制作開始希望時期", "text", true, "例：2025年1月上旬〜"],
        ["公開希望時期", "text", true, "例：2025年3月末までに公開希望"],
        ["予算の目安", "text", true, "例：30〜50万円程度"],
        ["優先度（スピード／品質）", "text", false, "例：スピード重視／デザイン品質重視 など"],
        ["継続運用・保守希望", "textarea", false, "例：月1回更新代行をお願いしたい など"]
    ]
};

const tbody = document.getElementById('sheet-body');
const fields = [];

for (const [section, items] of Object.entries(sections)) {
    const catRow = document.createElement('tr');
    catRow.className = 'category-row';
    catRow.innerHTML = `<td colspan="3">■ ${section}</td>`;
    tbody.appendChild(catRow);

    items.forEach(([label, type, required, placeholder]) => {
        const id = `${section}-${label}`.replace(/[^a-zA-Z0-9]/g, '_');
        fields.push(id);

        const input = type === 'textarea'
            ? `<textarea id="${id}" placeholder="${placeholder || `${label}を入力してください`}"></textarea>`
            : `<input type="text" id="${id}" placeholder="${placeholder || `${label}を入力してください`}">`;

        const row = document.createElement('tr');
        row.innerHTML = `
            <td><div class="question">${label}</div></td>
            <td>${input}</td>
            <td><span class="status-badge ${required ? 'required' : 'optional'}">${required ? '必須' : '任意'}</span></td>
        `;
        tbody.appendChild(row);
    });
}

// 自動保存
fields.forEach(id => {
    const el = document.getElementById(id);
    const saved = localStorage.getItem(id);
    if (saved) el.value = saved;
    el.addEventListener('input', () => localStorage.setItem(id, el.value));
});

// エクスポート
function exportData() {
    let output = "Webサイト制作ヒアリングシート（黒基調 完全版）\n";
    output += "=".repeat(50) + "\n\n";

    for (const [section, items] of Object.entries(sections)) {
        output += `■ ${section}\n` + "-".repeat(50) + "\n";
        items.forEach(([label]) => {
            const id = `${section}-${label}`.replace(/[^a-zA-Z0-9]/g, '_');
            const value = document.getElementById(id).value || "（未入力）";
            output += `${label}:\n${value}\n\n`;
        });
        output += "\n";
    }

    const blob = new Blob([output], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `ヒアリングシート_${new Date().toISOString().split("T")[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
}
</script>
